Starting: E:\CodePath\go\GoEV\GoPath\bin\dlv.exe dap --check-go-version=false --listen=127.0.0.1:49599 from F:\Study\GO\Gorm\gorm\gorm-note/code/04_unit_exercises/level5
DAP server listening at: 127.0.0.1:49599
Type 'dlv help' for list of commands.
=== GORM Level 5 性能优化练习 ===

请选择要使用的数据库类型：
1. SQLite (默认，快速测试)
2. MySQL (生产环境测试)
3. 两种数据库对比测试

=== MySQL 数据库演示 ===
注意：请确保MySQL服务已启动，数据库连接配置正确
正在连接MySQL数据库...
✓ MySQL数据库连接成功
Database migration completed successfully
✓ 复合索引创建完成
✓ 数据库结构初始化完成

=== MySQL 性能测试开始 ===
开始生成测试数据: 2000用户, 5000文章, 10000评论
✓ 用户数据生成完成: 2000条
✓ 文章数据生成完成: 5000条
✓ 评论数据生成完成: 10000条
✓ 测试数据生成完成，耗时: 19.0279223s

=== 基本查询性能测试 ===
简单查询 (100条): 40.3906ms
索引查询 (城市): 10.6043ms
范围查询 (薪资): 15.3864ms
复合条件查询: 12.6534ms

=== 预加载性能测试 ===
N+1查询 (50篇文章): 208.5431ms
预加载查询 (50篇文章): 13.3771ms
选择性预加载 (50篇文章): 28.6522ms
多层预加载 (20篇文章): 48.5803ms

=== 批量操作性能测试 ===
单条插入 (100条): 4.6093214s
批量插入 (100条, 批次50): 311.0961ms
大批量插入 (500条, 批次100): 540.4508ms
批量更新: 126.2089ms

=== 复杂查询性能测试 ===
聚合查询 (部门统计): 62.6586ms
子查询 (热门作者): 37.5022ms
复杂连接查询 (热门文章): 22.3593ms
分页查询 (第6页, 20条/页, 总计1607条): 42.2233ms
窗口函数查询 (部门内薪资排名): 2.5178ms, 结果数量: 0

=== 索引优化效果测试 ===
复合索引查询 (城市+状态): 65.0009ms, 结果: 259条
范围+等值查询 (薪资+部门): 58.4109ms, 结果: 144条
排序查询 (浏览量+评分): 24.844ms, 结果: 50条
模糊查询 (标题中间匹配): 24.5439ms, 结果: 100条
前缀匹配查询 (标题前缀): 4.5226ms, 结果: 0条
覆盖索引查询 (只查询索引字段): 32.0844ms, 结果: 722条

=== 连接池和事务性能测试 ===
普通查询 (100次): 429.7951ms
事务查询 (10个事务, 每个10次查询): 405.4122ms
并发查询 (10个goroutine, 每个10次查询): 517.1936ms

=== MySQL 性能测试完成 ===

=== MySQL 性能优化建议 ===
1. 索引优化：
   - 使用 EXPLAIN 分析查询执行计划
   - 合理设计复合索引，注意索引顺序
   - 避免在WHERE子句中使用函数
2. 查询优化：
   - 使用LIMIT限制结果集大小
   - 避免SELECT *，只查询需要的字段
   - 合理使用JOIN，避免笛卡尔积
3. 配置优化：
   - 调整innodb_buffer_pool_size
   - 优化连接池配置
   - 启用查询缓存（适当情况下）
✓ MySQL数据库连接已关闭

=== GORM 性能优化建议 ===
1. 索引优化:
   - 为经常查询的字段创建索引
   - 使用复合索引优化多字段查询
   - 避免在小表上创建过多索引

2. 查询优化:
   - 使用 Select 只查询需要的字段
   - 合理使用 Preload 避免 N+1 查询
   - 使用 Limit 限制查询结果数量
   - 避免在循环中执行查询

3. 批量操作:
   - 使用 CreateInBatches 进行批量插入
   - 使用批量更新替代循环更新
   - 合理设置批次大小

4. 连接池配置:
   - 设置合适的最大连接数
   - 配置连接生存时间
   - 监控连接池使用情况

5. 其他优化:
   - 启用预编译语句
   - 合理使用事务
   - 避免不必要的关联查询
   - 使用适当的日志级别

=== Level 5 性能优化练习完成 ===
Process 47804 has exited with status 0
Detaching
