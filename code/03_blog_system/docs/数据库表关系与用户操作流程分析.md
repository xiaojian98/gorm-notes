# åšå®¢ç³»ç»Ÿæ•°æ®åº“è¡¨å…³ç³»ä¸ç”¨æˆ·æ“ä½œæµç¨‹åˆ†æ ğŸ“Š

## ğŸ“‹ ç›®å½•
- [æ•°æ®åº“è¡¨ç»“æ„æ¦‚è§ˆ](#æ•°æ®åº“è¡¨ç»“æ„æ¦‚è§ˆ)
- [è¡¨å…³ç³»å›¾](#è¡¨å…³ç³»å›¾)
- [è¯¦ç»†è¡¨å…³ç³»è¯´æ˜](#è¯¦ç»†è¡¨å…³ç³»è¯´æ˜)
- [ç”¨æˆ·æ“ä½œæµç¨‹ä¸æ•°æ®å˜æ›´](#ç”¨æˆ·æ“ä½œæµç¨‹ä¸æ•°æ®å˜æ›´)
- [æ ¸å¿ƒä¸šåŠ¡åœºæ™¯åˆ†æ](#æ ¸å¿ƒä¸šåŠ¡åœºæ™¯åˆ†æ)
- [æ•°æ®å®Œæ•´æ€§çº¦æŸ](#æ•°æ®å®Œæ•´æ€§çº¦æŸ)

---

## ğŸ—‚ï¸ æ•°æ®åº“è¡¨ç»“æ„æ¦‚è§ˆ

### æ ¸å¿ƒè¡¨ç»“æ„

| è¡¨å | ä¸­æ–‡åç§° | ä¸»è¦åŠŸèƒ½ | å…³é”®å­—æ®µ |
|------|----------|----------|----------|
| `users` | ç”¨æˆ·è¡¨ | å­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ | id, username, email, password, status |
| `profiles` | ç”¨æˆ·èµ„æ–™è¡¨ | å­˜å‚¨ç”¨æˆ·è¯¦ç»†èµ„æ–™ | user_id, bio, website, location, birthday |
| `categories` | åˆ†ç±»è¡¨ | æ–‡ç« åˆ†ç±»ç®¡ç† | id, name, slug, description, post_count |
| `tags` | æ ‡ç­¾è¡¨ | æ–‡ç« æ ‡ç­¾ç®¡ç† | id, name, slug, post_count |
| `posts` | æ–‡ç« è¡¨ | å­˜å‚¨æ–‡ç« å†…å®¹ | id, title, content, user_id, category_id, status |
| `comments` | è¯„è®ºè¡¨ | æ–‡ç« è¯„è®ºç®¡ç† | id, content, post_id, user_id, parent_id |
| `likes` | ç‚¹èµè¡¨ | ç‚¹èµè®°å½•ç®¡ç† | id, user_id, target_id, target_type |
| `post_tags` | æ–‡ç« æ ‡ç­¾å…³è”è¡¨ | å¤šå¯¹å¤šå…³ç³» | post_id, tag_id |

---

## ğŸ”— è¡¨å…³ç³»å›¾

```mermaid
erDiagram
    USERS {
        uint id PK
        string username UK
        string email UK
        string password
        string nickname
        string avatar
        string status
        timestamp last_login_at
        int login_count
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }
    
    PROFILES {
        uint id PK
        uint user_id FK
        text bio
        string website
        string location
        timestamp birthday
        string gender
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }
    
    CATEGORIES {
        uint id PK
        string name
        string slug UK
        text description
        string color
        string icon
        int sort_order
        int post_count
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }
    
    TAGS {
        uint id PK
        string name
        string slug UK
        string color
        int post_count
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }
    
    POSTS {
        uint id PK
        string title
        string slug UK
        longtext content
        text excerpt
        string featured_img
        string status
        int view_count
        int like_count
        int comment_count
        timestamp published_at
        uint user_id FK
        uint category_id FK
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }
    
    COMMENTS {
        uint id PK
        text content
        string status
        string ip
        string user_agent
        uint post_id FK
        uint user_id FK
        uint parent_id FK
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }
    
    LIKES {
        uint id PK
        uint user_id FK
        uint target_id
        string target_type
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }
    
    POST_TAGS {
        uint post_id FK
        uint tag_id FK
        timestamp created_at
    }
    
    %% å…³ç³»å®šä¹‰
    USERS ||--o| PROFILES : "ä¸€å¯¹ä¸€"
    USERS ||--o{ POSTS : "ä¸€å¯¹å¤š"
    USERS ||--o{ COMMENTS : "ä¸€å¯¹å¤š"
    USERS ||--o{ LIKES : "ä¸€å¯¹å¤š"
    
    CATEGORIES ||--o{ POSTS : "ä¸€å¯¹å¤š"
    
    POSTS ||--o{ COMMENTS : "ä¸€å¯¹å¤š"
    POSTS ||--o{ LIKES : "ä¸€å¯¹å¤š(å¤šæ€)"
    POSTS }|--|| POST_TAGS : "å¤šå¯¹å¤š"
    TAGS }|--|| POST_TAGS : "å¤šå¯¹å¤š"
    
    COMMENTS ||--o{ COMMENTS : "è‡ªå…³è”(å›å¤)"
    COMMENTS ||--o{ LIKES : "ä¸€å¯¹å¤š(å¤šæ€)"
```

---

## ğŸ“ è¯¦ç»†è¡¨å…³ç³»è¯´æ˜

### 1. ç”¨æˆ·ç›¸å…³å…³ç³»

#### ğŸ”¸ Users â†” Profiles (ä¸€å¯¹ä¸€)
- **å…³ç³»ç±»å‹**: ä¸€å¯¹ä¸€ (1:1)
- **å¤–é”®**: `profiles.user_id` â†’ `users.id`
- **çº¦æŸ**: CASCADE (ç”¨æˆ·åˆ é™¤æ—¶ï¼Œèµ„æ–™ä¹Ÿåˆ é™¤)
- **è¯´æ˜**: æ¯ä¸ªç”¨æˆ·æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªè¯¦ç»†èµ„æ–™

```sql
-- å¤–é”®çº¦æŸ
CONSTRAINT fk_profiles_user_id 
FOREIGN KEY (user_id) REFERENCES users(id) 
ON UPDATE CASCADE ON DELETE CASCADE
```

#### ğŸ”¸ Users â†” Posts (ä¸€å¯¹å¤š)
- **å…³ç³»ç±»å‹**: ä¸€å¯¹å¤š (1:N)
- **å¤–é”®**: `posts.user_id` â†’ `users.id`
- **çº¦æŸ**: CASCADE (ç”¨æˆ·åˆ é™¤æ—¶ï¼Œæ–‡ç« ä¹Ÿåˆ é™¤)
- **è¯´æ˜**: ä¸€ä¸ªç”¨æˆ·å¯ä»¥å‘å¸ƒå¤šç¯‡æ–‡ç« 

#### ğŸ”¸ Users â†” Comments (ä¸€å¯¹å¤š)
- **å…³ç³»ç±»å‹**: ä¸€å¯¹å¤š (1:N)
- **å¤–é”®**: `comments.user_id` â†’ `users.id`
- **çº¦æŸ**: CASCADE (ç”¨æˆ·åˆ é™¤æ—¶ï¼Œè¯„è®ºä¹Ÿåˆ é™¤)
- **è¯´æ˜**: ä¸€ä¸ªç”¨æˆ·å¯ä»¥å‘è¡¨å¤šæ¡è¯„è®º

#### ğŸ”¸ Users â†” Likes (ä¸€å¯¹å¤š)
- **å…³ç³»ç±»å‹**: ä¸€å¯¹å¤š (1:N)
- **å¤–é”®**: `likes.user_id` â†’ `users.id`
- **çº¦æŸ**: CASCADE (ç”¨æˆ·åˆ é™¤æ—¶ï¼Œç‚¹èµè®°å½•ä¹Ÿåˆ é™¤)
- **è¯´æ˜**: ä¸€ä¸ªç”¨æˆ·å¯ä»¥ç‚¹èµå¤šä¸ªå¯¹è±¡

### 2. æ–‡ç« ç›¸å…³å…³ç³»

#### ğŸ”¸ Categories â†” Posts (ä¸€å¯¹å¤š)
- **å…³ç³»ç±»å‹**: ä¸€å¯¹å¤š (1:N)
- **å¤–é”®**: `posts.category_id` â†’ `categories.id`
- **çº¦æŸ**: SET NULL (åˆ†ç±»åˆ é™¤æ—¶ï¼Œæ–‡ç« çš„åˆ†ç±»è®¾ä¸ºNULL)
- **è¯´æ˜**: ä¸€ä¸ªåˆ†ç±»å¯ä»¥åŒ…å«å¤šç¯‡æ–‡ç« ï¼Œæ–‡ç« å¯ä»¥æ²¡æœ‰åˆ†ç±»

#### ğŸ”¸ Posts â†” Tags (å¤šå¯¹å¤š)
- **å…³ç³»ç±»å‹**: å¤šå¯¹å¤š (M:N)
- **ä¸­é—´è¡¨**: `post_tags`
- **å¤–é”®**: 
  - `post_tags.post_id` â†’ `posts.id`
  - `post_tags.tag_id` â†’ `tags.id`
- **çº¦æŸ**: CASCADE (æ–‡ç« æˆ–æ ‡ç­¾åˆ é™¤æ—¶ï¼Œå…³è”è®°å½•ä¹Ÿåˆ é™¤)
- **è¯´æ˜**: ä¸€ç¯‡æ–‡ç« å¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œä¸€ä¸ªæ ‡ç­¾å¯ä»¥å…³è”å¤šç¯‡æ–‡ç« 

#### ğŸ”¸ Posts â†” Comments (ä¸€å¯¹å¤š)
- **å…³ç³»ç±»å‹**: ä¸€å¯¹å¤š (1:N)
- **å¤–é”®**: `comments.post_id` â†’ `posts.id`
- **çº¦æŸ**: CASCADE (æ–‡ç« åˆ é™¤æ—¶ï¼Œè¯„è®ºä¹Ÿåˆ é™¤)
- **è¯´æ˜**: ä¸€ç¯‡æ–‡ç« å¯ä»¥æœ‰å¤šæ¡è¯„è®º

### 3. è¯„è®ºç›¸å…³å…³ç³»

#### ğŸ”¸ Comments â†” Comments (è‡ªå…³è”)
- **å…³ç³»ç±»å‹**: è‡ªå…³è” (1:N)
- **å¤–é”®**: `comments.parent_id` â†’ `comments.id`
- **çº¦æŸ**: CASCADE (çˆ¶è¯„è®ºåˆ é™¤æ—¶ï¼Œå­è¯„è®ºä¹Ÿåˆ é™¤)
- **è¯´æ˜**: æ”¯æŒè¯„è®ºå›å¤åŠŸèƒ½ï¼Œå½¢æˆæ ‘çŠ¶ç»“æ„

### 4. ç‚¹èµç›¸å…³å…³ç³» (å¤šæ€å…³ç³»)

#### ğŸ”¸ Likes â†” Posts/Comments (å¤šæ€ä¸€å¯¹å¤š)
- **å…³ç³»ç±»å‹**: å¤šæ€å…³ç³»
- **å­—æ®µ**: 
  - `likes.target_id`: ç›®æ ‡å¯¹è±¡ID
  - `likes.target_type`: ç›®æ ‡å¯¹è±¡ç±»å‹ ("post" æˆ– "comment")
- **çº¦æŸ**: å¤åˆå”¯ä¸€ç´¢å¼•é˜²æ­¢é‡å¤ç‚¹èµ
- **è¯´æ˜**: ç”¨æˆ·å¯ä»¥å¯¹æ–‡ç« æˆ–è¯„è®ºè¿›è¡Œç‚¹èµ

```sql
-- å¤åˆå”¯ä¸€ç´¢å¼•
UNIQUE INDEX idx_likes_user_target (user_id, target_id, target_type)
```

---

## ğŸš€ ç”¨æˆ·æ“ä½œæµç¨‹ä¸æ•°æ®å˜æ›´

### 1. ç”¨æˆ·æ³¨å†Œæµç¨‹ ğŸ“

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant API as APIæ¥å£
    participant DB as æ•°æ®åº“
    
    U->>API: POST /api/users/register
    Note over API: éªŒè¯ç”¨æˆ·å/é‚®ç®±å”¯ä¸€æ€§
    API->>DB: æŸ¥è¯¢ users è¡¨
    DB-->>API: è¿”å›æŸ¥è¯¢ç»“æœ
    
    Note over API: å¯†ç åŠ å¯†å¤„ç†
    API->>DB: INSERT INTO users
    Note over DB: è§¦å‘ AfterCreate é’©å­
    DB->>DB: INSERT INTO profiles (è‡ªåŠ¨åˆ›å»º)
    DB-->>API: è¿”å›ç”¨æˆ·ä¿¡æ¯
    API-->>U: æ³¨å†ŒæˆåŠŸå“åº”
```

**æ¶‰åŠè¡¨å˜æ›´**:
- âœ… `users` è¡¨: æ–°å¢ç”¨æˆ·è®°å½•
- âœ… `profiles` è¡¨: è‡ªåŠ¨åˆ›å»ºç”¨æˆ·èµ„æ–™è®°å½•

### 2. ç”¨æˆ·ç™»å½•æµç¨‹ ğŸ”

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant API as APIæ¥å£
    participant DB as æ•°æ®åº“
    
    U->>API: POST /api/users/login
    API->>DB: æŸ¥è¯¢ users è¡¨ (username/email)
    DB-->>API: è¿”å›ç”¨æˆ·ä¿¡æ¯
    
    Note over API: éªŒè¯å¯†ç å’Œç”¨æˆ·çŠ¶æ€
    API->>DB: UPDATE users (last_login_at, login_count)
    DB-->>API: æ›´æ–°æˆåŠŸ
    API-->>U: ç™»å½•æˆåŠŸ + Token
```

**æ¶‰åŠè¡¨å˜æ›´**:
- âœ… `users` è¡¨: æ›´æ–°æœ€åç™»å½•æ—¶é—´å’Œç™»å½•æ¬¡æ•°

### 3. å‘å¸ƒæ–‡ç« æµç¨‹ ğŸ“„

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant API as APIæ¥å£
    participant DB as æ•°æ®åº“
    
    U->>API: POST /api/posts
    Note over API: éªŒè¯æ–‡ç« æ•°æ®
    API->>DB: INSERT INTO posts
    
    Note over DB: è§¦å‘ AfterCreate é’©å­
    DB->>DB: UPDATE categories (post_count + 1)
    
    Note over API: å¤„ç†æ ‡ç­¾å…³è”
    API->>DB: INSERT INTO post_tags (æ‰¹é‡)
    DB->>DB: UPDATE tags (post_count + 1)
    
    DB-->>API: åˆ›å»ºæˆåŠŸ
    API-->>U: æ–‡ç« å‘å¸ƒæˆåŠŸ
```

**æ¶‰åŠè¡¨å˜æ›´**:
- âœ… `posts` è¡¨: æ–°å¢æ–‡ç« è®°å½•
- âœ… `categories` è¡¨: æ›´æ–°æ–‡ç« æ•°é‡è®¡æ•°
- âœ… `post_tags` è¡¨: æ–°å¢æ–‡ç« æ ‡ç­¾å…³è”
- âœ… `tags` è¡¨: æ›´æ–°æ ‡ç­¾ä½¿ç”¨è®¡æ•°

### 4. å‘è¡¨è¯„è®ºæµç¨‹ ğŸ’¬

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant API as APIæ¥å£
    participant DB as æ•°æ®åº“
    
    U->>API: POST /api/comments
    Note over API: éªŒè¯è¯„è®ºå†…å®¹å’Œæ–‡ç« å­˜åœ¨æ€§
    API->>DB: INSERT INTO comments
    
    Note over DB: è§¦å‘ AfterCreate é’©å­
    DB->>DB: UPDATE posts (comment_count + 1)
    
    DB-->>API: è¯„è®ºåˆ›å»ºæˆåŠŸ
    API-->>U: è¯„è®ºå‘è¡¨æˆåŠŸ
```

**æ¶‰åŠè¡¨å˜æ›´**:
- âœ… `comments` è¡¨: æ–°å¢è¯„è®ºè®°å½•
- âœ… `posts` è¡¨: æ›´æ–°è¯„è®ºæ•°é‡è®¡æ•°

### 5. ç‚¹èµæ“ä½œæµç¨‹ â¤ï¸

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant API as APIæ¥å£
    participant DB as æ•°æ®åº“
    
    U->>API: POST /api/posts/:id/like
    
    Note over API: æ£€æŸ¥æ˜¯å¦å·²ç‚¹èµ
    API->>DB: æŸ¥è¯¢ likes è¡¨
    DB-->>API: è¿”å›æŸ¥è¯¢ç»“æœ
    
    alt æœªç‚¹èµ
        API->>DB: INSERT INTO likes
        Note over DB: è§¦å‘ AfterCreate é’©å­
        DB->>DB: UPDATE posts (like_count + 1)
        DB-->>API: ç‚¹èµæˆåŠŸ
        API-->>U: ç‚¹èµæˆåŠŸ
    else å·²ç‚¹èµ
        API-->>U: é‡å¤ç‚¹èµé”™è¯¯
    end
```

**æ¶‰åŠè¡¨å˜æ›´**:
- âœ… `likes` è¡¨: æ–°å¢ç‚¹èµè®°å½•
- âœ… `posts` è¡¨: æ›´æ–°ç‚¹èµæ•°é‡è®¡æ•°

### 6. å–æ¶ˆç‚¹èµæµç¨‹ ğŸ’”

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant API as APIæ¥å£
    participant DB as æ•°æ®åº“
    
    U->>API: DELETE /api/posts/:id/like
    API->>DB: DELETE FROM likes
    
    Note over DB: è§¦å‘ AfterDelete é’©å­
    DB->>DB: UPDATE posts (like_count - 1)
    
    DB-->>API: å–æ¶ˆç‚¹èµæˆåŠŸ
    API-->>U: å–æ¶ˆç‚¹èµæˆåŠŸ
```

**æ¶‰åŠè¡¨å˜æ›´**:
- âœ… `likes` è¡¨: åˆ é™¤ç‚¹èµè®°å½•
- âœ… `posts` è¡¨: æ›´æ–°ç‚¹èµæ•°é‡è®¡æ•°

---

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡åœºæ™¯åˆ†æ

### åœºæ™¯1: ç”¨æˆ·å®Œæ•´ä½¿ç”¨æµç¨‹

```mermaid
flowchart TD
    A[ç”¨æˆ·è®¿é—®ç½‘ç«™] --> B[ç”¨æˆ·æ³¨å†Œ]
    B --> C[å®Œå–„ä¸ªäººèµ„æ–™]
    C --> D[æµè§ˆæ–‡ç« ]
    D --> E[å‘è¡¨è¯„è®º]
    E --> F[ç‚¹èµæ–‡ç« ]
    F --> G[åˆ›å»ºæ–‡ç« ]
    G --> H[é€‰æ‹©åˆ†ç±»]
    H --> I[æ·»åŠ æ ‡ç­¾]
    I --> J[å‘å¸ƒæ–‡ç« ]
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#f3e5f5
    style D fill:#e8f5e8
    style E fill:#fff3e0
    style F fill:#fff3e0
    style G fill:#fce4ec
    style H fill:#fce4ec
    style I fill:#fce4ec
    style J fill:#fce4ec
```

**æ•°æ®å˜æ›´æ—¶é—´çº¿**:
1. **æ³¨å†Œé˜¶æ®µ**: `users` + `profiles` è¡¨æ–°å¢è®°å½•
2. **èµ„æ–™å®Œå–„**: `profiles` è¡¨æ›´æ–°
3. **æµè§ˆæ–‡ç« **: `posts` è¡¨ `view_count` å¢åŠ 
4. **å‘è¡¨è¯„è®º**: `comments` è¡¨æ–°å¢ + `posts` è¡¨ `comment_count` å¢åŠ 
5. **ç‚¹èµæ–‡ç« **: `likes` è¡¨æ–°å¢ + `posts` è¡¨ `like_count` å¢åŠ 
6. **åˆ›å»ºæ–‡ç« **: `posts` è¡¨æ–°å¢ + `categories` è¡¨ `post_count` å¢åŠ 
7. **æ·»åŠ æ ‡ç­¾**: `post_tags` è¡¨æ–°å¢ + `tags` è¡¨ `post_count` å¢åŠ 

### åœºæ™¯2: æ–‡ç« ç”Ÿå‘½å‘¨æœŸ

```mermaid
stateDiagram-v2
    [*] --> è‰ç¨¿: åˆ›å»ºæ–‡ç« 
    è‰ç¨¿ --> å·²å‘å¸ƒ: å‘å¸ƒæ–‡ç« 
    è‰ç¨¿ --> å·²å½’æ¡£: å½’æ¡£æ–‡ç« 
    å·²å‘å¸ƒ --> å·²å½’æ¡£: å½’æ¡£æ–‡ç« 
    å·²å½’æ¡£ --> å·²å‘å¸ƒ: é‡æ–°å‘å¸ƒ
    å·²å‘å¸ƒ --> [*]: åˆ é™¤æ–‡ç« 
    è‰ç¨¿ --> [*]: åˆ é™¤æ–‡ç« 
    å·²å½’æ¡£ --> [*]: åˆ é™¤æ–‡ç« 
    
    è‰ç¨¿ : status = 'draft'
    å·²å‘å¸ƒ : status = 'published'
    å·²å½’æ¡£ : status = 'archived'
```

**çŠ¶æ€å˜æ›´å¯¹æ•°æ®çš„å½±å“**:
- **è‰ç¨¿ â†’ å·²å‘å¸ƒ**: `posts.status` æ›´æ–°, `posts.published_at` è®¾ç½®
- **å‘å¸ƒ â†’ å½’æ¡£**: `posts.status` æ›´æ–°
- **åˆ é™¤æ–‡ç« **: çº§è”åˆ é™¤ `comments`, `likes`, `post_tags` è®°å½•

---

## ğŸ›¡ï¸ æ•°æ®å®Œæ•´æ€§çº¦æŸ

### 1. ä¸»é”®çº¦æŸ
```sql
-- æ‰€æœ‰è¡¨éƒ½æœ‰è‡ªå¢ä¸»é”®
id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY
```

### 2. å”¯ä¸€æ€§çº¦æŸ
```sql
-- ç”¨æˆ·è¡¨
UNIQUE INDEX idx_user_username (username)
UNIQUE INDEX idx_user_email (email)

-- åˆ†ç±»è¡¨
UNIQUE INDEX idx_category_slug (slug)

-- æ ‡ç­¾è¡¨
UNIQUE INDEX idx_tag_slug (slug)

-- æ–‡ç« è¡¨
UNIQUE INDEX idx_post_slug (slug)

-- ç‚¹èµè¡¨ (é˜²æ­¢é‡å¤ç‚¹èµ)
UNIQUE INDEX idx_likes_user_target (user_id, target_id, target_type)
```

### 3. å¤–é”®çº¦æŸ
```sql
-- ç”¨æˆ·èµ„æ–™
CONSTRAINT fk_profiles_user_id 
FOREIGN KEY (user_id) REFERENCES users(id) 
ON UPDATE CASCADE ON DELETE CASCADE

-- æ–‡ç« ä½œè€…
CONSTRAINT fk_posts_user_id 
FOREIGN KEY (user_id) REFERENCES users(id) 
ON UPDATE CASCADE ON DELETE CASCADE

-- æ–‡ç« åˆ†ç±»
CONSTRAINT fk_posts_category_id 
FOREIGN KEY (category_id) REFERENCES categories(id) 
ON UPDATE CASCADE ON DELETE SET NULL

-- è¯„è®ºå…³è”
CONSTRAINT fk_comments_post_id 
FOREIGN KEY (post_id) REFERENCES posts(id) 
ON UPDATE CASCADE ON DELETE CASCADE

CONSTRAINT fk_comments_user_id 
FOREIGN KEY (user_id) REFERENCES users(id) 
ON UPDATE CASCADE ON DELETE CASCADE

-- ç‚¹èµå…³è”
CONSTRAINT fk_likes_user_id 
FOREIGN KEY (user_id) REFERENCES users(id) 
ON UPDATE CASCADE ON DELETE CASCADE
```

### 4. æ£€æŸ¥çº¦æŸ
```sql
-- ç”¨æˆ·çŠ¶æ€æ£€æŸ¥
CHECK (status IN ('active', 'inactive', 'banned'))

-- æ–‡ç« çŠ¶æ€æ£€æŸ¥
CHECK (status IN ('draft', 'published', 'archived'))

-- è¯„è®ºçŠ¶æ€æ£€æŸ¥
CHECK (status IN ('pending', 'approved', 'rejected'))

-- ç‚¹èµç±»å‹æ£€æŸ¥
CHECK (target_type IN ('post', 'comment'))

-- æ€§åˆ«æ£€æŸ¥
CHECK (gender IN ('male', 'female', 'unknown'))
```

### 5. ç´¢å¼•ä¼˜åŒ–
```sql
-- æ€§èƒ½ä¼˜åŒ–ç´¢å¼•
INDEX idx_posts_status (status)
INDEX idx_posts_published_at (published_at)
INDEX idx_posts_view_count (view_count)
INDEX idx_posts_like_count (like_count)
INDEX idx_comments_status (status)
INDEX idx_users_status (status)
```

---

## ğŸ“Š æ€»ç»“

### æ ¸å¿ƒè¡¨å…³ç³»æ€»è§ˆ
- **ç”¨æˆ·ä¸­å¿ƒ**: `users` â†” `profiles` (1:1)
- **å†…å®¹ç®¡ç†**: `users` â†’ `posts` â†’ `comments` (1:N:N)
- **åˆ†ç±»ä½“ç³»**: `categories` â†’ `posts` (1:N)
- **æ ‡ç­¾ä½“ç³»**: `tags` â†” `posts` (M:N)
- **äº’åŠ¨åŠŸèƒ½**: `users` â†’ `likes` â†’ `posts/comments` (å¤šæ€)
- **è¯„è®ºå›å¤**: `comments` â†’ `comments` (è‡ªå…³è”)

### æ•°æ®æµå‘ç‰¹ç‚¹
1. **ç”¨æˆ·æ³¨å†Œ**: è‡ªåŠ¨åˆ›å»ºç”¨æˆ·èµ„æ–™
2. **æ–‡ç« å‘å¸ƒ**: è‡ªåŠ¨æ›´æ–°åˆ†ç±»å’Œæ ‡ç­¾è®¡æ•°
3. **è¯„è®ºå‘è¡¨**: è‡ªåŠ¨æ›´æ–°æ–‡ç« è¯„è®ºæ•°
4. **ç‚¹èµæ“ä½œ**: è‡ªåŠ¨æ›´æ–°ç›®æ ‡å¯¹è±¡ç‚¹èµæ•°
5. **æ•°æ®åˆ é™¤**: çº§è”åˆ é™¤ç›¸å…³è®°å½•

### ç³»ç»Ÿè®¾è®¡äº®ç‚¹
- âœ¨ **å¤šæ€å…³ç³»**: ç‚¹èµç³»ç»Ÿæ”¯æŒæ–‡ç« å’Œè¯„è®º
- âœ¨ **è‡ªå…³è”**: è¯„è®ºæ”¯æŒå¤šçº§å›å¤
- âœ¨ **é’©å­å‡½æ•°**: è‡ªåŠ¨ç»´æŠ¤è®¡æ•°å­—æ®µ
- âœ¨ **è½¯åˆ é™¤**: æ”¯æŒæ•°æ®æ¢å¤
- âœ¨ **çº¦æŸå®Œæ•´**: ä¿è¯æ•°æ®ä¸€è‡´æ€§

è¿™ä¸ªåšå®¢ç³»ç»Ÿçš„æ•°æ®åº“è®¾è®¡å……åˆ†ä½“ç°äº†å…³ç³»å‹æ•°æ®åº“çš„ä¼˜åŠ¿ï¼Œé€šè¿‡åˆç†çš„è¡¨å…³ç³»è®¾è®¡å’Œçº¦æŸæœºåˆ¶ï¼Œç¡®ä¿äº†æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼ŒåŒæ—¶æ”¯æŒå¤æ‚çš„ä¸šåŠ¡åœºæ™¯å’Œç”¨æˆ·äº¤äº’åŠŸèƒ½ã€‚ğŸ‰