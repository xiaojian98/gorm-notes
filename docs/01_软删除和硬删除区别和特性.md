在 GORM 中，你提到的这段代码：

```go
// 软删除
db.Delete(&foundUser)
fmt.Println("用户已软删除")

// 真实删除
db.Unscoped().Delete(&foundUser)
fmt.Println("用户已被真实删除")
```

其中 **“软删除”**（Soft Delete）的实现依赖于一个关键机制：**模型中必须包含一个 `gorm.DeletedAt` 字段**。

---

### ✅ 软删除的必要条件

要使 GORM 的 `Delete()` 方法执行**软删除**，必须满足以下 **两个条件**：

---

#### ✅ 条件 1：结构体中包含 `gorm.DeletedAt` 字段

你的模型（如 `User`）必须嵌入或显式声明 `gorm.DeletedAt` 字段。

最常见的方式是 **嵌入 `gorm.Model`**：

```go
type User struct {
    gorm.Model // 包含 ID, CreatedAt, UpdatedAt, DeletedAt
    Name string
}
```

或者，如果你不想使用 `gorm.Model`，可以**手动添加 `DeletedAt` 字段**：

```go
type User struct {
    ID       uint
    Name     string
    DeletedAt gorm.DeletedAt `gorm:"index"` // 关键：必须有这个字段
}
```

> ⚠️ `gorm.DeletedAt` 是一个结构体类型，它能正确处理 `NULL` 值和时间记录。如果使用 `*time.Time`，GORM 也能识别为软删除字段，但推荐使用 `gorm.DeletedAt` 更标准。

---

#### ✅ 条件 2：使用 `Delete()` 方法删除记录

当你调用：

```go
db.Delete(&user)
```

GORM 会检测该模型是否有 `DeletedAt` 字段：

- 如果有 → 执行**软删除**：将当前时间写入 `DeletedAt` 字段（数据库中标记为已删除），**不真正从数据库删除行**。
- 如果没有 → 执行**硬删除**：直接从数据库删除该行。

---

### 🔍 软删除的原理

```sql
-- 执行 db.Delete(&user) 后生成的 SQL 类似：
UPDATE users SET deleted_at = '2025-08-09 17:00:00' WHERE id = 1;
```

该记录仍然存在于数据库中，只是被标记为“已删除”。

---

### 🚫 普通查询会自动忽略软删除的记录

GORM 默认会在查询中添加 `WHERE deleted_at IS NULL`，所以：

```go
var user User
db.First(&user, 1) // 找不到已被软删除的用户
```

---

### ✅ 如何查询已被软删除的记录？

使用 `Unscoped()`：

```go
db.Unscoped().Where("id = 1").First(&user) // 可以查到软删除的记录
```

---

### ✅ 如何执行真实删除（硬删除）？

```go
db.Unscoped().Delete(&user) // 真正从数据库删除，无法恢复
```

生成的 SQL：

```sql
DELETE FROM users WHERE id = 1;
```

---

### ✅ 总结：软删除的必要条件

| 条件 | 说明 |
|------|------|
| ✅ 1. 模型包含 `DeletedAt` 字段 | 推荐使用 `gorm.Model` 或手动添加 `gorm.DeletedAt` |
| ✅ 2. 调用 `db.Delete(&record)` | GORM 自动识别并执行软删除 |
| ❌ 缺少 `DeletedAt` 字段 | `Delete()` 会直接硬删除 |

---

### 💡 示例完整结构体

```go
import "gorm.io/gorm"

type User struct {
    ID        uint           `gorm:"primaryKey"`
    Name      string
    CreatedAt time.Time
    UpdatedAt time.Time
    DeletedAt gorm.DeletedAt `gorm:"index"` // 软删除关键字段
}
```

只要有了这个结构，`db.Delete()` 就是软删除，`db.Unscoped().Delete()` 才是真实删除。

---